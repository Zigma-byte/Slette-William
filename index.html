<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slette William</title>
<link rel="icon" type="image/x-icon" href="./lw.png">
<style>
body {
  margin:0;
  background:#f7f7f7;
  font-family:sans-serif;
  overflow:hidden;
}
.settings {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: white;
  border-bottom: 2px solid black;
  padding: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  z-index: 10;
  box-sizing: border-box;
}
.settings label {
  display:flex;
  flex-direction: column;
  font-size:14px;
}
input[type=range]{ width: 150px; }
canvas {
  display:block;
  position:absolute;
  top:120px;
  left:0;
  width:100%;
  height:calc(100vh - 120px);
}
#pauseMenu{
  position: fixed;
  top:120px;
  left:0;
  width:100%;
  height: calc(100vh - 120px);
  background: rgba(0,0,0,0.7);
  color:white;
  display:none;
  justify-content:center;
  align-items:center;
  z-index:20;
}
#pauseMenu div{text-align:center;}
#pauseMenu button{margin:10px; padding:10px 20px; font-size:16px; cursor:pointer;}
</style>
</head>
<body>

<div class="settings">
  <label>
    Cactus Spawn Frequency (ms)
    <input type="range" min="400" max="2000" id="spawnFreq">
    <span id="spawnFreqVal"></span>
  </label>
  <label>
    William's Speed
    <input type="range" min="2" max="12" id="dinoSpeed">
    <span id="dinoSpeedVal"></span>
  </label>
  <label>
    Jump Power
    <input type="range" min="6" max="20" id="jumpPower">
    <span id="jumpPowerVal"></span>
  </label>
  <label>
    Gravity
    <input type="range" min="0.2" max="2" step="0.1" id="gravity">
    <span id="gravityVal"></span>
  </label>
  <label>
    Passive Score Rate (+points/sec)
    <input type="range" min="0" max="1" step="0.05" id="scoreRate">
    <span id="scoreRateVal"></span>
  </label>
  <label>
    Hard Jump Chance (%)
    <input type="range" min="0" max="100" id="hardJump">
    <span id="hardJumpVal"></span>
  </label>
  <label>
    Character Hitbox Height
    <input type="range" min="20" max="100" id="hitHeight">
    <span id="hitHeightVal"></span>
  </label>
  <button id="resetSettings">Reset Settings</button>
</div>

<canvas id="gameCanvas"></canvas>

<div id="pauseMenu">
  <div>
    <h2>Game Paused</h2>
    <button onclick="resumeGame()">Resume</button>
    <button onclick="restartGame()">Restart</button>
  </div>
</div>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight-120;

const dinoImg=new Image();
const cacImg=new Image();
const jetImg=new Image();
dinoImg.src="./lw.png";
cacImg.src="./cac.png";
jetImg.src="./fw.png";

const passSound=new Audio("./sound.mp3");
const milestoneSound=new Audio("./over.mp3");
const background1=new Audio("./back.mp3");
const background2=new Audio("./back2.mp3");
background1.volume=0.4;
background2.volume=0.4;

// Settings
const settings = {
  spawnFreq: document.getElementById("spawnFreq"),
  dinoSpeed: document.getElementById("dinoSpeed"),
  jumpPower: document.getElementById("jumpPower"),
  gravity: document.getElementById("gravity"),
  scoreRate: document.getElementById("scoreRate"),
  hardJump: document.getElementById("hardJump"),
  hitHeight: document.getElementById("hitHeight")
};
const displayValues = {
  spawnFreqVal: document.getElementById("spawnFreqVal"),
  dinoSpeedVal: document.getElementById("dinoSpeedVal"),
  jumpPowerVal: document.getElementById("jumpPowerVal"),
  gravityVal: document.getElementById("gravityVal"),
  scoreRateVal: document.getElementById("scoreRateVal"),
  hardJumpVal: document.getElementById("hardJumpVal"),
  hitHeightVal: document.getElementById("hitHeightVal")
};

const defaults={spawnFreq:1000,dinoSpeed:6,jumpPower:12,gravity:0.6,scoreRate:0.2,hardJump:12.5,hitHeight:30};
for(let key in settings){
  settings[key].value=localStorage.getItem(key)||defaults[key];
  displayValues[key+"Val"].textContent=settings[key].value;
  settings[key].addEventListener("input",()=>{
    displayValues[key+"Val"].textContent=settings[key].value;
    localStorage.setItem(key,settings[key].value);
  });
}

// Reset settings button
document.getElementById("resetSettings").addEventListener("click",()=>{
  for(let key in defaults){
    localStorage.setItem(key, defaults[key]);
  }
  location.reload();
});

let dino={
  x:50,
  y:-10,
  width:60,
  height:70,
  hitHeight:parseFloat(settings.hitHeight.value),
  dy:0,
  isJumping:false
};
let cactuses=[];
let jets=[];
let fallingCactuses=[];
let score=0;
let highScore=localStorage.getItem("highScore")||0;
let gameOver=false;
let paused=false;
const ground=canvas.height-80;
let cactusTimer=null;
let jetsUnlocked = false; // flag for jet spawning

function drawDino(){ctx.drawImage(dinoImg,dino.x,dino.y,dino.width,dino.height);}
function drawCactus(c){ctx.drawImage(cacImg,c.x,c.y,c.width,c.height);}

function spawnCactus(){
  if(paused||gameOver) return;
  let width=Math.floor(Math.random()*20)+20;
  let height=Math.floor(Math.random()*40)+40;
  let gap=Math.floor(Math.random()*200)+400;

  if(Math.random()*100<parseFloat(settings.hardJump.value)){
    let first={x:canvas.width+gap,y:ground+(60-height),width:width,height:height};
    let second={x:first.x+first.width+Math.floor(Math.random()*10)+10,y:ground+(60-height),width:width,height:height};
    cactuses.push(first,second);
  }else{
    cactuses.push({x:canvas.width+gap,y:ground+(60-height),width:width,height:height});
  }

  cactusTimer=setTimeout(spawnCactus,Math.random()*700+parseFloat(settings.spawnFreq.value));
}

function spawnJet() {
  if (paused || gameOver) return;
  let jet = {
    x: -100,
    y: Math.random() * 80 + 20, // HIGHER UP
    width: 100,
    height: 60,
    speed: 4,
    dropCooldown: Math.floor(Math.random() * 60) + 30
  };
  jets.push(jet);
  setTimeout(spawnJet, Math.random() * 5000 + 5000);
}

function updateJets() {
  for (let i = 0; i < jets.length; i++) {
    let jet = jets[i];
    jet.x += jet.speed;

    jet.dropCooldown--;
    if (jet.dropCooldown <= 0) {
      fallingCactuses.push({
        x: jet.x + jet.width / 2 - 10,
        y: jet.y + jet.height,
        width: 20,
        height: 40,
        dy: 5,  // vertical speed
        dx: -2  // horizontal speed left
      });
      jet.dropCooldown = Math.floor(Math.random() * 60) + 30;
    }

    if (jet.x > canvas.width + 100) {
      jets.splice(i, 1);
      i--;
    } else {
      ctx.drawImage(jetImg, jet.x, jet.y, jet.width, jet.height);
    }
  }

  for (let i = 0; i < fallingCactuses.length; i++) {
    let fc = fallingCactuses[i];
    fc.y += fc.dy;
    fc.x += 15; // move left
    ctx.drawImage(cacImg, fc.x, fc.y, fc.width, fc.height);

    // Collision with player
    if (dino.x < fc.x + fc.width &&
        dino.x + dino.width > fc.x &&
        dino.y < fc.y + fc.height &&
        dino.y + dino.hitHeight > fc.y) {
            gameOver = true;
            if(score > highScore){ highScore = score; localStorage.setItem("highScore", highScore); }
            alert("Game Over! Score: " + Math.floor(score));
            document.location.reload();
    }

    if (fc.y > canvas.height + 50 || fc.x + fc.width < 0) {
        fallingCactuses.splice(i, 1);
        i--;
    }
  }
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(!paused && !gameOver){
    dino.y+=dino.dy;
    if(dino.y+dino.height<canvas.height) dino.dy+=parseFloat(settings.gravity.value);
    if(dino.y>=ground){ dino.y=ground; dino.dy=0; dino.isJumping=false; }

    for(let i=0;i<cactuses.length;i++){
      let c=cactuses[i];
      c.x-=parseFloat(settings.dinoSpeed.value);
      drawCactus(c);

      if(dino.x<c.x+c.width&&dino.x+dino.width>c.x&&dino.y<c.y+c.height&&dino.y+dino.hitHeight>c.y){
        gameOver=true;
        if(score>highScore){highScore=score; localStorage.setItem("highScore",highScore);}
        alert("Game Over! Score: "+Math.floor(score));
        document.location.reload();
      }
      if(c.x+c.width<0){cactuses.splice(i,1);passSound.currentTime=0;passSound.play();score++;i--;}
    }

    drawDino();

    // Start jet spawning when score crosses 55
    if (!jetsUnlocked && score > 15) {
      jetsUnlocked = true;
      spawnJet();
    }

    if(jetsUnlocked) updateJets();

    ctx.fillStyle="black";
    ctx.font="20px Arial";
    ctx.fillText("Score: "+Math.floor(score),canvas.width-150,30);
    ctx.fillText("High Score: "+Math.floor(highScore),canvas.width-150,60);
  }

  requestAnimationFrame(update);
}

// Passive score over time
setInterval(()=>{
  if(!paused&&!gameOver){
    score += parseFloat(settings.scoreRate.value)*0.5;
    if(Math.floor(score)%10===0) milestoneSound.play();
  }
},500);

function jump(){
  if(!dino.isJumping){
    dino.dy=-parseFloat(settings.jumpPower.value);
    dino.isJumping=true;
  }
}

function togglePause(){
  paused=!paused;
  document.getElementById("pauseMenu").style.display=paused?"flex":"none";
}
function resumeGame(){
  paused = false;
  document.getElementById("pauseMenu").style.display = "none";
}
function restartGame(){
  clearTimeout(cactusTimer);
  score=0; gameOver=false; paused=false;
  cactuses=[];
  jets=[];
  fallingCactuses=[];
  jetsUnlocked=false;
  dino.y=-10; dino.dy=0; dino.isJumping=false;
  document.getElementById("pauseMenu").style.display="none";
  spawnCactus();
}

// Controls
document.addEventListener("keydown",(e)=>{
  if(e.code==="Space"){jump(); if(!musicPlaying) playRandomTrack();}
  if(e.code==="KeyP"){togglePause();}
});
canvas.addEventListener("click", ()=>{ jump(); if(!musicPlaying) playRandomTrack(); });
canvas.addEventListener("touchstart", (e)=>{ e.preventDefault(); jump(); if(!musicPlaying) playRandomTrack(); }, {passive:false});

dinoImg.onload=()=>{update(); spawnCactus();}
window.addEventListener("resize",()=>{canvas.height=window.innerHeight-120;});

// Music system
let musicPlaying=false;
function playRandomTrack(){
  musicPlaying=true;
  let pick=Math.random()<0.5 ? background1 : background2;
  background1.pause(); background2.pause();
  background1.currentTime=0; background2.currentTime=0;
  pick.play();
  pick.onended=()=>{musicPlaying=false; playRandomTrack();}
}
</script>
</body>
</html>
